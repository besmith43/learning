@page "/counter"
@inject HttpClient Http
@inject Microsoft.Extensions.Configuration.IConfiguration config

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;

    private async Task IncrementCount()
    {
        var result = privIncrementCount();

        if (result.IsT0)
        {
            currentCount = result.AsT0.Count;
        }
        else
        {
            Console.WriteLine(result.AsT1.Message);
            currentCount = -1;
        }
        StateHasChanged();
    }

    private OneOf<hello.Shared.Models.Counter, ErrorMessage> privIncrementCount()
    {
        // currentCount++;

        var response = Http.GetAsync(config["BaseAPIUrl"] + "/counter").Result;

        if (response.IsSuccessStatusCode)
        {
            hello.Shared.Models.Counter result = response.Content.ReadFromJsonAsync<hello.Shared.Models.Counter>().Result;
            Console.WriteLine(result.Count);
            return result;
        }
        else
        {
            var result = response.Content.ReadFromJsonAsync<ErrorMessage>().Result;
            Console.WriteLine(result.Message);
            return result;
        }
    }
}
