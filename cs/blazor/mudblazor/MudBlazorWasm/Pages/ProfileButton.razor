@page "/profileButton"
@inject IDialogService DialogService

@* <MudButton OnClick="OpenDialog" Variant="Variant.Filled" Color="Color.Primary">Open Dialog</MudButton> *@

@* <MudButton OnClick="OpenMessageBox" Variant="Variant.Filled" Color="Color.Primary">Open MessageBox</MudButton> *@
<MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="OnButtonClicked" >Delete</MudButton>
<MudChip>@state</MudChip>

<MudMessageBox @ref="mbox" Title="Warning" CancelText="Cancel">
    <MessageContent>
        Deleting can <b><i>not</i></b> be undone!
        <MudTextField T="string" TextChanged="TextChanged" Immediate Placeholder="@("Please type 'test' in order to confirm")" />
    </MessageContent>
    <YesButton>
        <MudButton Disabled="@_disabled" Variant="Variant.Filled" Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever">Delete!</MudButton>
    </YesButton>
</MudMessageBox>

@code {
    MudMessageBox mbox { get; set; }
    string state = "Message box hasn't been opened yet";
    public bool _disabled = true;

    private async void OnButtonClicked()
    {
        Console.WriteLine("Opening message box");
        bool? result = await mbox.Show();
        state= result==null ? "Cancelled" : "Deleted!";
        StateHasChanged();
    }

    private async Task TextChanged(string text)
    {
        _disabled = !text.Equals("test");
        await InvokeAsync(StateHasChanged);
    }

    // this is old code that doesn't work
    private async void OpenMessageBox()
    {
        Console.WriteLine("Opening message box");
        bool? result = await DialogService.ShowMessageBox(
            "Warning", 
            "Deleting can not be undone!", 
            yesText:"Delete!", cancelText:"Cancel");
        StateHasChanged();
    }

    private void OpenDialog()
    {
        // this isn't currently working, but it should
        Console.WriteLine("Opening dialog");
        var options = new DialogOptions { CloseOnEscapeKey = true };
        try
        {
            DialogService.Show<ProfileDialog>("Profile Dialog", options);
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
        }
    }
}